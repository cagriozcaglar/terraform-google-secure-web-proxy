#
# Copyright 2023 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
apiVersion: blueprints.cloud.google.com/v1alpha1
kind: BlueprintMetadata
metadata:
  name: terraform-google-swp-gateway-security-policy
  annotations:
    config.kubernetes.io/local-config: "true"
spec:
  info:
    title: "Secure Web Proxy (SWP) Gateway Security Policy"
    source:
      type: git
      git:
        repo: https://github.com/GoogleCloudPlatform/terraform-google-swp-gateway-security-policy.git
        dir: /
        ref: main
    version: 1.0.0
    actuationTool:
      type: Terraform
      version: ">= 1.3"
    description:
      tagline: A Terraform module for creating a Google Cloud Gateway Security Policy and its associated rules for Secure Web Proxy (SWP).
      detailed: This module simplifies the creation and management of Google Cloud Gateway Security Policies and Rules. It requires the google-beta provider as Secure Web Proxy is a beta feature. It allows you to define a policy and a set of rules that control traffic, including features like TLS inspection.
    examples:
      - name: simple_policy
        location: examples/simple_policy
    labels:
      gcp: ""
      network-security: ""
      swp: ""

  interfaces:
    variables:
      - name: policy_description
        description: "A free-text description of the Gateway Security Policy."
        type: string
        default: "Gateway Security Policy managed by Terraform"
        required: false
      - name: policy_name
        description: "The name of the Gateway Security Policy."
        type: string
        default: "default-gateway-security-policy"
        required: false
      - name: project_id
        description: "The ID of the project in which the resource belongs. If not set, the provider project will be used."
        type: string
        default: null
        required: false
      - name: rules
        description: "A list of rule objects to create for the Gateway Security Policy. Each object defines a rule with fields like name, description, enabled, priority, basic_profile ('ALLOW'/'DENY'), session_matcher, application_matcher, and tls_inspection_enabled."
        type: list(object)
        default: []
        required: false
    variableGroups:
      - name: "Policy Configuration"
        description: "Settings for the Gateway Security Policy resource."
        variables:
          - project_id
          - policy_name
          - policy_description
      - name: "Security Rules"
        description: "Define the individual security rules for the policy."
        variables:
          - rules
    outputs:
      - name: policy_id
        description: "The fully qualified ID of the Gateway Security Policy."
      - name: policy_name
        description: "The name of the Gateway Security Policy."
      - name: rules_map
        description: "A map of the created Gateway Security Policy Rules, with rule names as keys and rule IDs as values."

  requirements:
    services:
      - networksecurity.googleapis.com
    roles:
      - level: project
        roles:
          - roles/networksecurity.admin
    permissions:
      - networksecurity.gatewaySecurityPolicies.create
      - networksecurity.gatewaySecurityPolicies.get
      - networksecurity.gatewaySecurityPolicies.delete
      - networksecurity.gatewaySecurityPolicyRules.create
      - networksecurity.gatewaySecurityPolicyRules.get
      - networksecurity.gatewaySecurityPolicyRules.delete
